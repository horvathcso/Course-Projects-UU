%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% 3rd order upwind SBP operator           %%%
%%%                                         %%%
%%% Derived by Ken Mattsson                 %%%
%%%                                         %%%
%%% Set number of unknowns m, grid step h   %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


 
H=diag(ones(m,1),0);
H(1:4,1:4)=[0.4347899357e10 / 0.12695947216e11 0 0 0; 0 0.12032349023e11 / 0.9521960412e10 0 0; 0 0 0.32831414215e11 / 0.38087841648e11 0; 0 0 0 0.6550489565e10 / 0.6347973608e10;];
H(m-3:m,m-3:m)=fliplr(flipud(H(1:4,1:4)));
H=H*h;
HI=inv(H);


   
Qp=(-1/3*diag(ones(m-1,1),-1)-1/2*diag(ones(m,1),0)+1*diag(ones(m-1,1),+1)-1/6*diag(ones(m-2,1),+2));

Q_U = [-0.847e3 / 0.37560e5 0.79604458492699e14 / 0.119214944358240e15 -0.1643521867663e13 / 0.14901868044780e14 -0.4160444549287e13 / 0.119214944358240e15; -0.22671019561497e14 / 0.39738314786080e14 -0.6023e4 / 0.37560e5 0.91628011326497e14 / 0.119214944358240e15 -0.749671686919e12 / 0.19869157393040e14; 0.63495586071e11 / 0.1241822337065e13 -0.16644840223051e14 / 0.39738314786080e14 -0.4311e4 / 0.12520e5 0.104757273135509e15 / 0.119214944358240e15; 0.4998377065543e13 / 0.119214944358240e15 -0.5276507651527e13 / 0.59607472179120e14 -0.12476888349687e14 / 0.39738314786080e14 -0.5919e4 / 0.12520e5;];

Qp(1:4,1:4)=Q_U;
Qp(m-3:m,m-3:m)=flipud( fliplr(Q_U(1:4,1:4) ) )'; %%% This is different from standard SBP

Qm=-Qp';

e_1=zeros(m,1);e_1(1)=1;
e_m=zeros(m,1);e_m(m)=1;

Dp=HI*(Qp-1/2*e_1*e_1'+1/2*e_m*e_m') ;

Dm=HI*(Qm-1/2*e_1*e_1'+1/2*e_m*e_m') ;



